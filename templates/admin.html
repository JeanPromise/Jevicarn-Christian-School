{% extends 'base.html' %}
{% block content %}
<style>
  body {
    background-color: #f0f8ff;
  }

  .admin-container {
    max-width: 950px;
    margin: 30px auto;
    background-color: #ffffff;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.15);
    overflow: hidden;
  }

  .admin-header {
    background-color: #0d47a1;
    color: white;
    text-align: center;
    padding: 14px;
    font-size: 1.2em;
    font-weight: bold;
  }

  .admin-chat-area {
    display: flex;
    height: 70vh;
  }

  .chat-list {
    width: 35%;
    border-right: 1px solid #ccc;
    overflow-y: auto;
    background-color: #e3f2fd;
  }

  .chat-list-item {
    padding: 10px;
    border-bottom: 1px solid #c5cae9;
    cursor: pointer;
  }

  .chat-list-item:hover {
    background-color: #bbdefb;
  }

  .chat-list-item.active {
    background-color: #90caf9;
  }

  .chat-box {
    flex: 1;
    display: flex;
    flex-direction: column;
    background-color: #eaf4ff;
  }

  .messages {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
  }

  .message {
    max-width: 75%;
    margin: 8px 0;
    padding: 10px 14px;
    border-radius: 12px;
    font-size: 0.95rem;
    word-wrap: break-word;
  }

  .user-msg {
    background-color: #0288d1;
    color: white;
    margin-left: auto;
  }

  .admin-msg {
    background-color: #0d47a1;
    color: white;
    align-self: flex-start;
  }

  .status {
    font-size: 0.8rem;
    color: #ddd;
    text-align: right;
    margin-top: 5px;
  }

  .timestamp {
    font-size: 0.75rem;
    color: #bbb;
    margin-top: 2px;
    text-align: right;
  }

  .reply-form {
    padding: 10px;
    background-color: white;
    border-top: 1px solid #ddd;
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .reply-form input[type="text"] {
    flex: 1;
    border-radius: 20px;
    border: 1px solid #ccc;
    padding: 8px 14px;
    outline: none;
  }

  .reply-form button {
    background-color: #0d47a1;
    color: white;
    border: none;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    cursor: pointer;
    font-size: 1.2rem;
  }

  .reply-form button:hover {
    background-color: #08306b;
  }
</style>

<section class="admin-container">
  <div class="admin-header">
    üë©‚Äçüè´ Admin Chat Center - Jevicarn Christian School
  </div>

  <div class="admin-chat-area">
    <!-- Sender list -->
    <div class="chat-list">
      {% for sender in senders %}
        <div class="chat-list-item {% if sender == active_sender %}active{% endif %}">
          <a href="{{ url_for('admin', auth=request.args.get('auth'), sender=sender) }}" style="text-decoration:none; color:black;">
            {{ sender }}
          </a>
        </div>
      {% else %}
        <div style="padding:10px;color:#555;">No messages yet.</div>
      {% endfor %}
    </div>

    <!-- Chat window -->
    <div class="chat-box">
      <div class="messages">
        {% for msg in chat_messages %}
          <div class="message {{ 'user-msg' if msg.sender == 'user' else 'admin-msg' }}">
            {% if msg.text %}
              <div>{{ msg.text }}</div>
            {% endif %}
            {% if msg.filename %}
              <div><a href="{{ url_for('uploaded_file', filename=msg.filename) }}" target="_blank" style="color:#fff;text-decoration:underline;">üìé Attachment</a></div>
            {% endif %}
            <div class="status">{{ 'Seen' if msg.seen else '‚úì Sent' }}</div>
            <div class="timestamp">{{ msg.timestamp }}</div>
          </div>
        {% else %}
          <div style="text-align:center; color:#555;">Select a chat to view messages.</div>
        {% endfor %}
      </div>

      {% if active_sender %}
      <form method="POST" action="{{ url_for('admin_reply', sender=active_sender) }}?auth={{ request.args.get('auth','') }}" class="reply-form">
        <input type="text" name="text" placeholder="Type your reply..." required>
        <button title="Send Reply">üì§</button>
      </form>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
